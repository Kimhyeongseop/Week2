package com.example.basic;


import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Intent;
import android.graphics.BitmapFactory;
import android.net.Uri;
import android.os.Bundle;

import androidx.core.app.NotificationCompat;
import androidx.fragment.app.Fragment;

import android.os.Handler;
import android.os.Message;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;

import butterknife.ButterKnife;
import butterknife.OnClick;

import static android.content.Context.NOTIFICATION_SERVICE;
import static androidx.core.content.ContextCompat.getSystemService;


/**
 * A simple {@link Fragment} subclass.
 */
public class Else extends Fragment {
    int i=0;

    Thread thread;
    boolean isThread=false;


    public Else() {
        // Required empty public constructor
    }


    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {

        View view = inflater.inflate(R.layout.fragment_else,container, false);
        super.onCreate(savedInstanceState);
        ButterKnife.inject(this);
        Button button = (Button) view.findViewById(R.id.button);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                i = 0;
                isThread = true;
                thread = new Thread() {
                    public void run() {
                        while (true) {
                            try {
                                sleep(5000);//5000->360000
                                i++;
                            } catch (InterruptedException e) {
                                e.printStackTrace();
                            }
                            handler.sendEmptyMessage(0);
                        }

                    }
                };
                thread.start();
            }
        });
        return view;
    }

    private Handler handler = new Handler(){
        @Override
        public void handleMessage( Message msg) {
            sendNotification();
        }
    };


    @OnClick(R.id.button)
    public void sendNotification() {


        NotificationCompat.Builder builder = new NotificationCompat.Builder(this);
        builder.setSmallIcon(R.drawable.icon_bottle);
        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse("http://www.journaldev.com/"));
        PendingIntent pendingIntent = PendingIntent.getActivity(this, 0, intent, 0);
        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);

        builder.setContentIntent(pendingIntent);
        builder.setLargeIcon(BitmapFactory.decodeResource(getResources(), R.drawable.icon_bottle));
        builder.setContentTitle("물을 안마신지"+i+"시간이 지났어요!");
        builder.setContentText("물마시셈");
        builder.setSubText("Tap to view the website.");

        NotificationManager notificationManager = (NotificationManager) getActivity().getSystemService(NOTIFICATION_SERVICE);
        notificationManager.notify(1, builder.build());


        // Will display the notification in the notification bar



    }

}
